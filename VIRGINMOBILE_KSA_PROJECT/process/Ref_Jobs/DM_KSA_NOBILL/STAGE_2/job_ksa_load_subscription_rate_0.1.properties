<?xml version="1.0" encoding="UTF-8"?>
<xmi:XMI xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:TalendProperties="http://www.talend.org/properties">
  <TalendProperties:Property xmi:id="_2Xmb4DsyEemJnvy3UP1d7Q" id="_xMl8IIJDEeq5LL3ksDkZLA" label="job_ksa_load_subscription_rate" purpose="This job is to calculate the subscription rates per counterid" description="This job is to calculate the subscription rates per counterid. &#xD;&#xA;&#xD;&#xA;On a high level, this is achieved by: &#xD;&#xA;1) Get total event revenue &#xD;&#xA;2) Get total consumed volume &#xD;&#xA;3) Calculate average rate = total revenue/total volume &#xD;&#xA;4) Apply the calculated rate to counterid&#xD;&#xA;&#xD;&#xA;Detailed steps are the following:&#xD;&#xA;Step0) Clear the temp tables data for vLoadDate&#xD;&#xA;Step1) Aggregate event revenue (split into Main Wallet, Paid Counter and Bonus Counter) based on accountnum and event&#xD;&#xA;&#xD;&#xA;Step1-a) Split the Event Revenue into Main Wallet (main cost), Paid Counter (plan amount) and Bonus Counter (discount amount).&#xD;&#xA;&#x9;&#x9;&#x9;- Main wallet event revenue: SUM(fus_cost) from fact usage with service type id = 13 (for Event) with event category = Data/Voice by joining to dim event table.&#xD;&#xA;&#x9;&#x9;&#x9;- Paid counter event revenue: SUM(-facc_valuediff) from fact usage with service type id = 13 (for Event) with event category = Data/Voice by joining to dim event table and counter type category1 = 'Monetary' &amp; category2 not in ('Monetary Bonus','Initial Balance') by joining to dim counter type.&#xD;&#xA;&#x9;&#x9;&#x9;- Bonus counter event revenue: SUM(-facc_valuediff) from fact usage with service type id = 13 (for Event) with event category = Data/Voice by joining to dim event table and counter type category1 = 'Monetary' &amp; category2 in ('Monetary Bonus','Initial Balance') by joining to dim counter type.&#xD;&#xA;Step1-b) Merge results from Step 1-a&#xD;&#xA;Step1-c) Aggregate(sum) merged result from 1-b based on accountnum and eventid for the subscription date&#xD;&#xA;Step1-d) Load result from 1-c to nobill_fact_event table&#xD;&#xA;&#x9;&#x9;&#x9;&#xD;&#xA;Step2) Calculate total volume [sum(facc_valuediff) ] and average volumes[avg(facc_valuediff) ] by countertype by accountnum by event by date. &#xD;&#xA;&#xD;&#xA;-> At this stage valuediff field in converted into Megabytes from bytes (for Data) and into Minutes from milliseconds (for Voice)&#xD;&#xA;-> Join fact account number, dim counter type(to separate data and voice) and fact adjustment(to get account number).Insert aggregated reslult into nobill_fact_counter_volume_average&#xD;&#xA;&#xD;&#xA;Step3) Calculate the average subscription rate (main rate, plan rate, discount rate) for each counter type (for accountnum by event).&#xD;&#xA;&#xD;&#xA;-> Join result set from Step1-d and Step2 to calculate following: &#xD;&#xA;&#x9; main_rate = main_cost/valuediff/total_unique_events&#xD;&#xA;     plan_rate = plan_amount/valuediff/total_unique_events&#xD;&#xA;     discount_rate = discount_amount/valuediff/total_unique_events&#xD;&#xA;-> Load into nobill_fact_subscription_rate_avg along with dcr_cost_split. dcr_cost_split is required to get the cost split in case of combo bundles&#xD;&#xA;&#x9;&#xD;&#xA;Step4) Apply the subscription rate to individual counter id&#xD;&#xA;&#xD;&#xA;Step4-a) Get counter id, counter type, account num and eventid by joining fact account number, fact adjustment and dim counter type tables&#xD;&#xA;Step4-b) Get records from Step3 with REVISED subscription rate which is: main rate, plan rate, discount rate each multiplied by the dcr_cost_split&#xD;&#xA;Step4-c) Join Step4-a and Step4-b based on countertype, accountnum, eventid and get the subscription rates for each counterid and load into nobill_fact_subscription_rate table&#xD;&#xA;&#xD;&#xA;Date: 07-Apr-2019&#xD;&#xA;Name: Salini&#xD;&#xA;Modification: 1) Added tJoblog components." version="0.1" statusCode="" item="_2Xmb4jsyEemJnvy3UP1d7Q" displayName="job_ksa_load_subscription_rate">
    <author href="../../../../talend.project#_3YFPsBmIEe6L8djGrCFUzA"/>
    <additionalProperties xmi:id="_2jydwDsyEemJnvy3UP1d7Q" key="created_product_fullname" value="Talend Cloud Real-Time Big Data Platform"/>
    <additionalProperties xmi:id="_2jydwTsyEemJnvy3UP1d7Q" key="created_product_version" value="7.3.1.20200219_1130"/>
    <additionalProperties xmi:id="_2jydwjsyEemJnvy3UP1d7Q" key="created_date" value="2020-04-19T17:43:36.825+0400"/>
    <additionalProperties xmi:id="_2jydwzsyEemJnvy3UP1d7Q" key="modified_product_fullname" value="Talend Cloud Data Fabric"/>
    <additionalProperties xmi:id="_2jydxDsyEemJnvy3UP1d7Q" key="modified_product_version" value="8.0.1.20221221_1125-patch"/>
    <additionalProperties xmi:id="_2jydxTsyEemJnvy3UP1d7Q" key="modified_date" value="2023-03-10T10:50:53.788+0400"/>
    <additionalProperties xmi:id="_xNmiGr88EemYLPPK5FomYg" key="import_product_fullname" value="Talend Cloud Data Fabric"/>
    <additionalProperties xmi:id="_xNmiG788EemYLPPK5FomYg" key="import_product_version" value="8.0.1.20230216_0930-patch"/>
    <additionalProperties xmi:id="_xNmiHL88EemYLPPK5FomYg" key="import_date" value="2023-07-03T15:49:38.765+0530"/>
    <additionalProperties xmi:id="_dpbCAIJEEeq5LL3ksDkZLA" key="FRAMEWORK" value=""/>
  </TalendProperties:Property>
  <TalendProperties:ItemState xmi:id="_JtjgQBmLEe6L8djGrCFUzA" path="Ref_Jobs/DM_KSA_NOBILL/STAGE_2"/>
  <TalendProperties:ProcessItem xmi:id="_2Xmb4jsyEemJnvy3UP1d7Q" property="_2Xmb4DsyEemJnvy3UP1d7Q" state="_JtjgQBmLEe6L8djGrCFUzA">
    <process href="job_ksa_load_subscription_rate_0.1.item#/"/>
  </TalendProperties:ProcessItem>
</xmi:XMI>
